<div class="container rounded-container">
  <h2 class="text-center mb-5">My dashboard</h2>
  <h3 class="mt-3">Your flat(s)</h3>
  <% if current_user.flats.present? %>
    <% @flats.each do |flat| %>
      <div class="container-dashboard mt-3">
        <div class="card-flat-description-dashboard">
          <%= link_to flat_path(flat) do %>
            <h4><%= flat.title %></h4>
          <% end %>
          <p><%= flat.description %></p>
          <p>Number of guests allowed: <%= flat.number_of_guests %></p>
          <p><%= flat.price_per_day %>$ per night</p>
          <p>Address: <%= flat.address %></p>
          <div class="buttons d-flex">
            <p><%= link_to "Delete flat",
                          flat_path(flat),
                          method: :delete,
                          data: { confirm: "Are you sure?" },
                          class: "btn btn-danger mr-3" %></p>
            <p><%= link_to "Update flat", edit_flat_path(flat), class: "btn pink-btn" %></p>
          </div>
        </div>
        <% if flat.reservations.present? %>
          <h4 class="mt-3 mb-3">Your reservation(s) for <%= flat.title %></h4>
          <div class="container-cards-dashboard">
            <% flat.reservations.each do |reservation| %>
              <div class="card-reservation">
                <% if reservation.status == "pending" %>
                  <% if reservation.reservation_end < Date.today %>
                    <p class="status-archived">Status: archived</p>
                  <% else %>
                    <p class="status-pending">Status: <%= reservation.status %></p>
                  <% end %>
                  <div>
                    <p>Guest name: <%= reservation.user.first_name %> <%= reservation.user.last_name %></p>
                    <p>Number of guests: <%= reservation.number_of_guests %></p>
                    <% number_of_nights = reservation.reservation_end - reservation.reservation_start %>
                    <p>Stay: from <%= reservation.reservation_start.strftime("%B %d %Y") %> to <%= reservation.reservation_end.strftime("%B %d %Y") %></p>
                    <p>Number of nights: <%= number_of_nights.to_i %></p>
                    <% total_cost = number_of_nights * flat.price_per_day %>
                    <p>Total cost: <%= total_cost.to_i %>€</p>
                  </div>
                  <div class="buttons">
                    <%= link_to "Accept", reservation_accept_status_path(reservation), class: "btn green-btn mr-3" %>
                    <%= link_to "Reject", reservation_reject_status_path(reservation), class: "btn violet-btn" %>
                  </div>
                <% end %>
                <% if reservation.status == "accepted" %>
                  <% if reservation.reservation_end < Date.today %>
                    <p class="status-archived">Status: archived</p>
                  <% else %>
                    <p class="status-accepted">Status: <%= reservation.status %></p>
                  <% end %>
                  <div>
                    <p>Guest name: <%= reservation.user.first_name %> <%= reservation.user.last_name %></p>
                    <p>Number of guests: <%= reservation.number_of_guests %></p>
                    <% number_of_nights = reservation.reservation_end - reservation.reservation_start %>
                    <p>Stay: from <%= reservation.reservation_start.strftime("%B %d %Y") %> to <%= reservation.reservation_end.strftime("%B %d %Y") %></p>
                    <p>Number of nights: <%= number_of_nights.to_i %></p>
                    <% total_cost = number_of_nights * flat.price_per_day %>
                    <p>Total cost: <%= total_cost.to_i %>€</p>
                  </div>
                  <div class="buttons">
                    <a class="btn pink-btn" href="mailto:<%= reservation.user.email %>"> Contact <%= reservation.user.first_name %> </a>
                  </div>
                <% end %>
                <% if reservation.status == "rejected" %>
                  <p class="status-rejected">Status: <%= reservation.status %></p>
                  <div>
                    <p>Guest name: <%= reservation.user.first_name %> <%= reservation.user.last_name %></p>
                    <p>Number of guests: <%= reservation.number_of_guests %></p>
                    <% number_of_nights = reservation.reservation_end - reservation.reservation_start %>
                    <p>Stay: from <%= reservation.reservation_start.strftime("%B %d %Y") %> to <%= reservation.reservation_end.strftime("%B %d %Y") %></p>
                    <p>Number of nights: <%= number_of_nights.to_i %></p>
                    <% total_cost = number_of_nights * flat.price_per_day %>
                    <p>Total cost: <%= total_cost.to_i %>€</p>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="mt-3">You have no reservation for <%= flat.title %></p>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p>You have no flats</p>
  <% end %>
  <%= link_to "Create a flat", new_flat_path, class: "btn blue-btn mt-3 mb-5" %>
  <h3 class="mt-3">Your reservation(s)</h3>
  <% if current_user.reservations.present? %>
    <div class="container-description mt-3">
      <div class="container-cards-dashboard">
        <% @reservations.each do |reservation| %>
          <div class="card-reservation">
            <% if reservation.status == "pending" %>
              <% if reservation.reservation_end < Date.today %>
                <p class="status-archived">Status: archived</p>
              <% else %>
                <p class="status-pending">Status: <%= reservation.status %></p>
              <% end %>
              <div>
                <p>You have made a reservation for
                  <%= link_to flat_path(reservation.flat) do %>
                    <%= reservation.flat.title %>
                  <% end %>
                </p>
                <p>Host: <%= reservation.flat.user.first_name %> <%= reservation.flat.user.last_name %></p>
                <p>Number of guests: <%= reservation.number_of_guests %></p>
                <% number_of_nights = reservation.reservation_end - reservation.reservation_start %>
                <p>Stay: from <%= reservation.reservation_start.strftime("%B %d %Y") %> to <%= reservation.reservation_end.strftime("%B %d %Y") %></p>
                <p>Number of nights: <%= number_of_nights.to_i %></p>
                <% flat = Flat.find(reservation.flat_id) %>
                <% total_cost = number_of_nights * flat.price_per_day %>
                <p>Total cost: <%= total_cost.to_i %>€</p>
              </div>
              <div class="buttons">
                <%= link_to "Cancel",
                          reservation_path(reservation),
                          method: :delete,
                          data: { confirm: "Are you sure?" },
                          class: "btn violet-btn" %>
              </div>
            <% end %>
            <% if reservation.status == "rejected" %>
              <p class="status-rejected">Status: <%= reservation.status %></p>
              <div>
                <p>You have made a reservation for
                  <%= link_to flat_path(reservation.flat) do %>
                    <%= reservation.flat.title %>
                  <% end %>
                </p>
                <p>Host: <%= reservation.flat.user.first_name %> <%= reservation.flat.user.last_name %></p>
                <p>Number of guests: <%= reservation.number_of_guests %></p>
                <% number_of_nights = reservation.reservation_end - reservation.reservation_start %>
                <p>Stay: from <%= reservation.reservation_start.strftime("%B %d %Y") %> to <%= reservation.reservation_end.strftime("%B %d %Y") %></p>
                <p>Number of nights: <%= number_of_nights.to_i %></p>
                <% flat = Flat.find(reservation.flat_id) %>
                <% total_cost = number_of_nights * flat.price_per_day %>
                <p>Total cost: <%= total_cost.to_i %>€</p>
              </div>
              <div class="buttons">
                <%= link_to "Delete",
                            reservation_path(reservation),
                            method: :delete,
                            data: { confirm: "Are you sure?" },
                            class: "btn btn-danger" %>

              </div>
            <% end %>
            <% if reservation.status == "accepted" %>
              <% if reservation.reservation_end < Date.today %>
                <p class="status-archived">Status: archived</p>
              <% else %>
                <p class="status-accepted">Status: <%= reservation.status %></p>
              <% end %>
              <div>
                <p>You have made a reservation for
                  <%= link_to flat_path(reservation.flat) do %>
                    <%= reservation.flat.title %>
                  <% end %>
                </p>
                <p>Host: <%= reservation.flat.user.first_name %> <%= reservation.flat.user.last_name %></p>
                <p>Number of guests: <%= reservation.number_of_guests %></p>
                <% number_of_nights = reservation.reservation_end - reservation.reservation_start %>
                <p>Stay: from <%= reservation.reservation_start.strftime("%B %d %Y") %> to <%= reservation.reservation_end.strftime("%B %d %Y") %></p>
                <p>Number of nights: <%= number_of_nights.to_i %></p>
                <% flat = Flat.find(reservation.flat_id) %>
                <% total_cost = number_of_nights * flat.price_per_day %>
                <p>Total cost: <%= total_cost.to_i %>€</p>
              </div>
              <div class="buttons">
                <a class="btn pink-btn" href="mailto:<%= reservation.flat.user.email %>"> Contact <%= reservation.flat.user.first_name %> </a>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <p>You have no reservations</p>
  <% end %>
  <%= link_to "Browse the flats", flats_path, class: "btn blue-btn mt-3" %>
</div>
